# =====================================================
# Copyright 2025 Focason Co.,Ltd. AllRights Reserved.
# =====================================================

# -----------------------------------------------------
# 1. Spring Boot Configuration
# -----------------------------------------------------
server:
  port: ${SERVER_PORT:8081}                                          # The server port for this service
  address: 0.0.0.0                                                   # Binds to all network interfaces

spring:
  application:
    name: ${APPLICATION_NAME:focason-platform-service}               # Application name (used in Eureka/Config Server)
  main:
    allow-bean-definition-overriding: true                           # Allows redefining bean definitions
    allow-circular-references: true                                  # Allows circular dependency injection

  # RabbitMQ Configuration
  rabbitmq:
    host: ${RABBITMQ_HOST:localhost}                                 # RabbitMQ host address
    port: ${RABBITMQ_PORT:5672}                                      # RabbitMQ port
    username: ${RABBITMQ_USERNAME:guest}                             # RabbitMQ username
    password: ${RABBITMQ_PASSWORD:guest}                             # RabbitMQ password

  # Datasource Configuration
  datasource:
    url: jdbc:mysql://${DB_HOST:localhost}:${DB_PORT:3306}/${DB_SCHEMA:focason}?useSSL=false&autoReconnect=true&characterEncoding=UTF-8&useUnicode=yes&allowPublicKeyRetrieval=true&serverTimezone=Asia/Tokyo
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:password}
    driver-class-name: com.mysql.jdbc.Driver                         # MySQL JDBC Driver

  # Jackson (JSON serialization) Configuration
  jackson:
    time-zone: Asia/Tokyo                                            # Default timezone for date/time serialization

  # FreeMarker Configuration
  freemarker:
    check-template-location: true                                    # Check if template location exists
    template-loader-path:
      - "classpath:/templates/"                                      # Default path for general templates
      - "classpath:/templates/mail/"                                 # Dedicated path for email templates

  # JPA (Hibernate) Configuration
  jpa:
    database-platform: org.hibernate.dialect.MySQLDialect            # Specifies MySQL dialect
    open-in-view: off                                                # Disables Open Session In View pattern

  # Spring Cloud Config Client Configuration
  cloud:
    config:
      name: ${CLOUD_CONFIG_NAME:focason-platform-service}            # Name of the configuration file to fetch
      label: ${GITHUB_BRANCH:main}                                   # Git branch label (e.g., main, dev)
      profile: ${GITHUB_PROFILE:default}                             # Profile to load (e.g., dev, prod)
      discovery:
        enabled: true                                                # Enable discovery service lookup for Config Server
        service-id: ${CONFIG_SERVICE_ID:focason-config-server}       # Config Server service ID

  # Mail Configuration
  mail:
    host: ${MAIL_HOST:mail.privateemail.com}
    port: ${MAIL_PORT:587}
    username: ${MAIL_USERNAME:noreply@focason.com}
    password: ${MAIL_PASSWORD:qazPL1225-}                            # Email password or App Password
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true                                             # Enables STARTTLS for secure connection

  # Redis Configuration
  redis:
    host: ${REDIS_HOST:127.0.0.1}
    port: 6379
    timeout: 3000ms                                                  # Connection timeout
    lettuce:
      pool:
        max-active: 20                                               # Maximum number of active connections in the pool
        max-wait: 100ms                                              # Maximum blocking wait time (negative values indicate no timeout)
        max-idle: 20                                                 # Maximum number of idle connections
        min-idle: 5                                                  # Minimum number of idle connections

management:
  endpoints:
    web:
      exposure:
        # Exposes Actuator endpoints for monitoring and administration
        include: refresh, bus-refresh, health

# ----------------------------------------------------
# 2. Spring Cloud Service Discovery (Eureka) Configuration
# ----------------------------------------------------
eureka:
  instance:
    hostname: ${INSTANCE_HOSTNAME:localhost}                         # Hostname used for registration
  client:
    service-url:
      # Eureka Server registration URL, including basic auth credentials
      defaultZone: http://${EUREKA_SERVER_USERNAME:root}:${EUREKA_SERVER_PASSWORD:password}@${EUREKA_HOSTNAME:localhost}:8761/eureka/

# ----------------------------------------------------
# 3. Logging Configuration
# ----------------------------------------------------
logging:
  file:
    name: logs/focason-platform-service.log                          # Path to the log file
  level:
    root: ${LOG_LEVEL:INFO}                                          # Default logging level


# ----------------------------------------------------
# 5. Project Specific Configuration
# ----------------------------------------------------
focason:
  # ----------------------------------------------------
  # 5-1. Email Configuration
  # ----------------------------------------------------
  email:
    send-by: ${EMAIL_SEND_BY:Focason Lab Team}                       # Display name for sender
    send-from: ${EMAIL_SEND_FROM:noreply@focason.com}                # Email address for sender
  # ----------------------------------------------------
  # 5-2. AWS Configuration
  # ----------------------------------------------------
  cloud:
    aws:
      region: ${AWS_REGION:ap-northeast-1}                           # AWS region
      # S3 Configuration
      s3:
        file-config:
          bucket-name: ${AWS_BUCKET_NAME:focason-cloud-file}         # S3 bucket name for uploads
          prefix:                                                    # Optional prefix for S3 objects
          pre-signed-url-valid-minutes: ${PRESIGNED_URL_VALID_MINUTES:1440} # Pre-signed URL validity in minutes (Max 10080)
      # SQS Configuration (supports multiple queues)
      sqs:
        # Default queue
        default-queue:
          queue-url: https://sqs.ap-northeast-1.amazonaws.com/123456789012/your-queue-name
          max-number-of-messages: 10
          wait-time-seconds: 20
          visibility-timeout: 30
          message-retention-period: 345600  # 4 days
          enable-dead-letter-queue: false
          dead-letter-queue-url: https://sqs.ap-northeast-1.amazonaws.com/123456789012/your-dlq-name
          max-receive-count: 3
        # Another queue example
        notification-queue:
          queue-url: https://sqs.ap-northeast-1.amazonaws.com/123456789012/notification-queue
          max-number-of-messages: 5
          wait-time-seconds: 10
          visibility-timeout: 60
      # Cognito Configuration (existing)
      cognito:
        user-pool-id: ${COGNITO_USER_POOL_ID:your-user-pool-id}
        client-id: ${COGNITO_CLIENT_ID:your-client-id}
        client-secret: ${COGNITO_CLIENT_SECRET:your-client-secret}